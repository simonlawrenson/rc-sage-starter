'use strict';window.tsfem={nonce:tsfemL10n.nonce,i18n:tsfemL10n.i18n,rtl:tsfemL10n.rtl,debug:tsfemL10n.debug,touchBuffer:!1,noticeBuffer:!1,navWarn:!1,setTouchBuffer:function(a){tsfem.touchBuffer=!0,setTimeout(()=>{tsfem.touchBuffer=!1},a)},_initToolTips:function(){let a=0,b=!1,c=!1;try{let q=Object.defineProperty({},'passive',{get:()=>{c=!0}});window.addEventListener('tsfem-test-passive',q,q).removeEventListener('tsfem-test-passive',q,q)}catch(q){}const d=()=>{b=!0,clearTimeout(a),a=setTimeout(()=>{b=!1},250)},f=(q,r)=>{r=r||!1;let s='pointerdown.tsfemTT touchstart.tsfemTT click.tsfemTT',t=jQuery(q);r?(t.off('mousemove mouseleave mouseout tsfem-tooltip-update'),jQuery(document.body).off(s)):(t.on({mousemove:k,mouseleave:l,mouseout:l}),jQuery(document.body).off(s).on(s,m)),t.on('tsfem-tooltip-update',h)},g=q=>{f(q,!0)},h=q=>{if(q.target.classList.contains('tsfem-tooltip-item')){let r=q.target.querySelector('.tsfem-tooltip-text');r instanceof Element&&(r.innerHTML=q.target.dataset.desc)}},j=q=>{let r=jQuery(q.target),s=q.target.dataset.desc||q.target.title||'';s&&0===q.target.getElementsByClassName('tsfem-tooltip').length&&(q.target.dataset.desc=s,q.target.title='',tsfem.doTooltip(q,q.target,s))},k=q=>{let r=jQuery(q.target),s=r.find('.tsfem-tooltip'),t=s.find('.tsfem-tooltip-arrow'),u=q.originalEvent&&q.originalEvent.pageX||q.pageX,v=7,w=16,x=r.closest('.tsfem-tooltip-wrap'),y=u-x.offset().left-w/2,A=s.find('.tsfem-tooltip-text-wrap'),B=A.outerWidth(!0),C=s.data('adjust'),D=s.data('adjustDir'),E=B-w-v;if(C=parseInt(C,10),C=isNaN(C)?0:Math.round(C),C&&(C='left'===D?-C:C,y+=C,E-C>x.outerWidth(!0))){let F=A.find('.tsfem-tooltip-text'),G=F.outerWidth(!0);E=G-w-v}y<=v?t.css('left',v+'px'):y>=E?t.css('left',E+'px'):t.css('left',y+'px')},l=q=>{b||(tsfem.removeTooltip(q.target),g(q.target))},m=q=>{d();let u,s='.tsfem-tooltip',t=jQuery(q.target);if(t.hasClass('tsfem-tooltip-item')&&(u=t.find(s)),!u){let v=t.children('.tsfem-tooltip-item');v.length&&(u=v.find(s))}u&&u.length?jQuery(s).not(u).remove():jQuery(s).remove()},n=q=>{if(!b){let r=!1;switch(q.type){case'mouseenter':break;case'pointerdown':case'touchstart':r=!0;break;default:}r&&m(q),j(q),k(q),f(q.target)}},o=q=>{q.target.classList.contains('tsfem-tooltip-item')&&n(q),q.stopPropagation()},p=()=>{let q=document.querySelectorAll('.tsfem-tooltip-wrap'),r=!c||{capture:!0,passive:!0};for(let s=0;s<q.length;s++)'mouseenter pointerdown touchstart'.split(' ').forEach(t=>{q[s].removeEventListener(t,o,r),q[s].addEventListener(t,o,r)})};p(),jQuery(window).on('tsfem-reset-tooltips',p),tsfem.addTooltipBoundary('#wpcontent')},doTooltip:function(a,b,c){let d=jQuery(b);if(d.find('.tsfem-tooltip').length&&tsfem.removeTooltip(b),!!c.length){let f=jQuery('<div class="tsfem-tooltip"><span class="tsfem-tooltip-text-wrap"><span class="tsfem-tooltip-text">'+c+'</span></span><div class="tsfem-tooltip-arrow"></div></div>');d.append(f);let g=d.closest('.tsfem-tooltip-boundary');g=g.length&&g||jQuery(document.body);let h=d.outerHeight()+8,j=f.offset().top-h,k=g.offset().top-(g.prop('scrolltop')||0);k>j?(f.addClass('tsfem-tooltip-down'),f.css('top',h+'px')):f.css('bottom',h+'px');let l=d.closest('.tsfem-tooltip-wrap');l.length||(l=d.parent());let m=f.find('.tsfem-tooltip-text-wrap'),n=m.find('.tsfem-tooltip-text'),o=l.width(),p=m.outerWidth(!0),q=n.outerWidth(!0),r=m.offset().left,t=g.offset().left-(g.prop('scrollLeft')||0),u=t+g.outerWidth(),v='left';if(r<t){let w=t-r+12,x=parseInt(m.css('flex-basis'),10);w<-x&&(w=-x),f.css(v,w+'px'),f.data('adjust',w),f.data('adjustDir',v)}else if(r+q>u){let w=u-r-p-12,x=parseInt(m.css('flex-basis'),10);w<-x&&(w=-x),f.css(v,w+'px'),f.data('adjust',w),f.data('adjustDir',v)}else if(42>o){let w=-15;f.css(v,w+'px'),f.data('adjust',w),f.data('adjustDir',v)}else if(a&&1>jQuery(a.target).find(f).length)f.css(v,'0px'),f.data('adjust',0),f.data('adjustDir',v);else if(a&&o>p){let w=a.originalEvent&&a.originalEvent.pageX||a.pageX,x=l.offset().left,z=w-x-p/2,A=z+p;0>z?z=0:A>o&&(z=o-q),f.css(v,z+'px'),f.data('adjust',z),f.data('adjustDir',v)}}},addTooltipBoundary:function(a){jQuery(a).addClass('tsfem-tooltip-boundary')},removeTooltip:function(a){tsfem.getTooltip(a).remove()},getTooltip:function(a){return jQuery(a).find('.tsfem-tooltip').first()},setAjaxLoader:function(a){jQuery(a).toggleClass('tsfem-loading')},unsetAjaxLoader:function(a,b,c,d){let f='tsfem-success',g=2500;b?2===b&&(f='tsfem-unknown',g=7500):(f='tsfem-error',g=d?2e4:1e4),g=c?2*g:g,d?jQuery(a).removeClass('tsfem-loading').addClass(f).html(c).fadeOut(g):(c=jQuery('<span/>').html(c).text(),jQuery(a).removeClass('tsfem-loading').addClass(f).text(c).fadeOut(g))},resetAjaxLoader:function(a){jQuery(a).stop().empty().prop('class','tsfem-ajax').css({opacity:'1',display:'initial'}).prop('style','')},updateFeed:function(a){let b='tsfem-button-disabled',c=jQuery(a.target),d='#tsfem-feed-ajax',f=0;if(!c.prop('disabled')){c.addClass(b),c.prop('disabled',!0),tsfem.resetAjaxLoader(d),tsfem.setAjaxLoader(d);const g=function(){c.removeClass(b),c.prop('disabled',!1),tsfem.updatedResponse(d,f,tsfem.i18n.UnknownError,0)};jQuery.ajax({method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_enable_feeds',nonce:tsfem.nonce},timeout:12000,async:!0}).done(h=>{h=tsfem.convertJSONResponse(h),tsfem.debug&&console.log(h);let j=h&&h.data||void 0,k=h&&h.type||void 0;if('success'===k&&j){let l=j.content;switch(l.status){case'success':f=1,jQuery('.tsfem-trends-wrap').empty().css('opacity',0).append(l.wrap).animate({opacity:1},{queue:!0,duration:250});let m=400,n=l.data.length,o=0;for(let p=1;p<n-1;p++)o+=Math.round(m/Math.pow(1+p/2/100,2));o-=2*m+m/2,jQuery.each(l.data,(p,q)=>{m=Math.round(m/Math.pow(1+p/2/100,2)),setTimeout(()=>{jQuery(q).hide().appendTo('.tsfem-feed-wrap').slideDown(m)},m/2*p)}),setTimeout(()=>{tsfem.updatedResponse(d,f,'',0)},o);break;case'parse_error':case'unknown_error':default:jQuery('.tsfem-trends-wrap').empty().css('opacity',0).append(l.error_output).css('opacity',1).find('.tsfem-feed-wrap').css({opacity:0}).animate({opacity:1},{queue:!0,duration:2e3}),f='unknown_error'===l.status?2:0,setTimeout(()=>{tsfem.updatedResponse(d,f,tsfem.i18n.UnknownError,0)},1e3);}}else'unknown'===h.type?(f=2,g()):g()}).fail((h,j,k)=>{let l=tsfem.getAjaxError(h,j,k);c.removeClass(b),c.prop('disabled',!1),tsfem.updatedResponse(d,0,l,0)})}},updateExtension:function(a){let b='tsfem-button-disabled',c=jQuery(a.target);if(!(c.prop('disabled')||c.hasClass(b))){let d=jQuery('.tsfem-button-extension-activate, .tsfem-button-extension-deactivate').not(jQuery('.'+b)),f=c.data('slug'),g=c.data('case'),h='#tsfem-extensions-ajax',j=0,k='',l=0,m='';d.map(()=>{jQuery(this).addClass(b),jQuery(this).prop('disabled',!0)}),tsfem.resetAjaxLoader(h),tsfem.setAjaxLoader(h),jQuery.ajax({method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_update_extension',nonce:tsfem.nonce,slug:f,'case':g},timeout:1e4,async:!0}).done(n=>{n=tsfem.convertJSONResponse(n),tsfem.debug&&console.log(n);let o=n&&n.data||void 0,p=n&&n.type||void 0;if(!o||!p)m=tsfem.i18n.UnknownError;else{let q=o.results&&o.results.code||void 0,r=o.results&&o.results.success||void 0;if(m=o.results&&o.results.notice||void 0,'activate'===g)switch(q){case 10001:case 10002:case 10003:case 10004:case 10006:case 10007:j=0,l=q;break;case 10005:j=0;let s=o&&o.fatal_error||void 0;k=s,l=q;break;case 10008:case 10010:case 10012:j=1,c.removeClass('tsfem-button-extension-activate').addClass('tsfem-button-extension-deactivate'),c.data('case','deactivate'),c.text(tsfem.i18n.Deactivate),jQuery('#'+f+'-extension-entry').removeClass('tsfem-extension-deactivated').addClass('tsfem-extension-activated'),tsfem.updateExtensionDescFooter(f,g);break;case 10009:j=2,l=q;break;default:j=0,m=tsfem.i18n.UnknownError;}else'deactivate'===g&&(11001===q?(j=1,c.removeClass('tsfem-button-extension-deactivate').addClass('tsfem-button-extension-activate'),c.data('case','activate'),c.text(tsfem.i18n.Activate),jQuery('#'+f+'-extension-entry').removeClass('tsfem-extension-activated').addClass('tsfem-extension-deactivated'),tsfem.updateExtensionDescFooter(f,g)):11002===q?(j=0,l=q):(j=0,m=tsfem.i18n.UnknownError))}}).fail((n,o,p)=>{m=tsfem.getAjaxError(n,o,p),tsfem.setTopNotice(1071100),p&&tsfem.setTopNotice(-1,'jQ error: '+p)}).always(()=>{tsfem.updatedResponse(h,j,m,0),d.removeClass(b),d.prop('disabled',!1),c.focus(),l&&tsfem.setTopNotice(l,k)})}},convertJSONResponse:function(a){let b=a&&a.json||void 0,c=1===b;if(!c){let d=a;try{a=JSON.parse(a),c=!0}catch(f){c=!1}c||(a=d)}return a},updatedResponse:function(a,b,c,d){switch(b){case 0:case 1:case 2:tsfem.unsetAjaxLoader(a,b,c,d);break;default:tsfem.resetAjaxLoader(a);}},getAjaxError:function(a,b,c){tsfem.debug&&(console.log(a.responseText),console.log(c));let d='';switch(c){case'abort':case'timeout':d=tsfem.i18n.TimeoutError;break;case'Bad Request':d=tsfem.i18n.BadRequest;break;case'Internal Server Error':d=tsfem.i18n.FatalError;break;case'parsererror':d=tsfem.i18n.ParseError;break;default:d=tsfem.i18n.UnknownError;}return d},unexpectedAjaxErrorNotice:function(a){a=tsfem.convertJSONResponse(a)||void 0;let b=a&&a.data||void 0;tsfem.debug&&console.log(a),b&&'results'in b&&'code'in b.results&&tsfem.setTopNotice(b.results.code,b.results.notice)},matosa:function(a){var b=null,c='';if(function f(g,h){if(h++,'object'==typeof g){let j,k;for(j in g)k=g[j];b=k,c+=1===h?j+f(k,h):'['+j+']'+f(k,h)}else if(1===h)return b=null,c=!1;return c}(a,0),!1===c)return!1;let d={};return d[c]=b,d},updateExtensionDescFooter:function(a,b){jQuery.ajax({method:'POST',url:ajaxurl,dataType:'json',data:{action:'tsfem_update_extension_desc_footer',nonce:tsfem.nonce,slug:a,'case':b},timeout:3e3,async:!0}).done(c=>{c=tsfem.convertJSONResponse(c),tsfem.debug&&console.log(c);let d=c&&c.data||void 0,f=c&&c.type||void 0;if(d){let g=jQuery('#'+a+'-extension-entry .tsfem-extension-description-footer'),h='activate'===b?'up':'down';g.addClass('tsfem-flip-hide-'+h),setTimeout(()=>{g.empty().append(d),jQuery(window).trigger('tsfem-reset-tooltips')},250),setTimeout(()=>{g.addClass('tsfem-flip-show-'+h)},500),setTimeout(()=>{g.removeClass('tsfem-flip-hide-'+h+' tsfem-flip-show-'+h)},750)}}).fail((c,d,f)=>{tsfem.debug&&(console.log(c.responseText),console.log(f))})},preventDefault:function(a){a.preventDefault(),a.stopPropagation()},engageSwitcher:function(){const b='click.tsfemResetSwitcher';jQuery(window).off(b).on(b,d=>{let f=jQuery('.tsfem-switch-button-container > input[type="checkbox"]:checked');if('undefined'!=typeof f&&0<f.length){let g=f.parents('.tsfem-switch-button-container-wrap');1>jQuery(d.target).closest(g).length&&(f.prop('checked',!1),jQuery(window).off(b))}})},setLastExtensionEntry:function(){let a=jQuery('.tsfem-extensions-overview-content').children('.tsfem-extension-entry-wrap'),b=a.length;if(1&b&&2<b){let c=a.first(),d=a.last();782>window.innerWidth?d.delay(10).css({'max-width':''}):d.delay(10).css({'max-width':c.width()})}},registerNavWarn:function(){tsfem.navWarn=!0},mustNavWarn:function(){return!!tsfem.navWarn},setDismissNoticeListener:function(){let a=jQuery('.tsfem-dismiss');const b=c=>{jQuery(c.target).closest('.tsfem-notice').slideUp(200,function(){this.remove()})};a.off('click',b),a.on('click',b)},setTopNotice:function(a,b){if(tsfem.noticeBuffer)return void window.setTimeout(()=>{tsfem.setTopNotice(a,b)},500);tsfem.noticeBuffer=!0;let c=b?1:0;jQuery.ajax({method:'POST',url:ajaxurl,datatype:'json',data:{action:'tsfem_get_dismissible_notice',nonce:tsfem.nonce,'tsfem-notice-key':a,'tsfem-notice-has-msg':c},timeout:7e3,async:!0}).done(d=>{d=tsfem.convertJSONResponse(d),tsfem.debug&&console.log(d);let f=d&&d.data||void 0,g=d&&d.type||void 0;if(!f||!g||'undefined'==typeof f.notice);else{let h='';c?(h=jQuery(f.notice),tsfem.rtl?h.find('p').first().prepend(b+' '):h.find('p').first().append(' '+b)):h=f.notice,tsfem.appendTopNotice(h)}}).fail((d,f,g)=>{tsfem.debug&&(console.log(d.responseText),console.log(g));let h=c?wp.template('tsfem-fbtopnotice-msg'):wp.template('tsfem-fbtopnotice'),j=h({code:a,msg:b});tsfem.appendTopNotice(j)}).always(()=>{tsfem.noticeBuffer=!1})},appendTopNotice:function(a){let b=jQuery('.tsfem-notice-wrap'),c=b.children('.tsfem-notice, .tsfem-notice-wrap .notice'),d={duration:200,queue:!1};b.css('willChange','contents'),1<c.length&&b.css('maxHeight',b.outerHeight()+'px'),1<c.length&&c.slice(0,c.length-1).each(function(){jQuery(this).slideUp(jQuery.extend(d,{complete:()=>this.remove()}))}),jQuery(a).hide().appendTo(b).slideDown(jQuery.extend(d,{complete:()=>b.css('maxHeight','')})),tsfem.setDismissNoticeListener()},dialog:function(a){let b=a.title||'',c=a.text||'',d=a.select||'',f=a.confirm||'',g=a.cancel||'',h={};if(h.mask=document.createElement('div'),h.mask.className='tsfem-modal-mask',h.maskNoScroll=document.createElement('div'),h.maskNoScroll.className='tsfem-modal-mask-noscroll',h.mask.appendChild(h.maskNoScroll),h.container=document.createElement('div'),h.container.className='tsfem-modal-container',h.dialogWrap=document.createElement('div'),h.dialogWrap.className='tsfem-modal-dialog-wrap',h.dialogWrap.style.marginLeft=document.getElementById('adminmenuwrap').offsetWidth+'px',h.dialogWrap.style.marginTop=document.getElementById('wpadminbar').offsetHeight+'px',h.dialog=document.createElement('div'),h.dialog.className='tsfem-modal-dialog',h.trap=document.createElement('div'),h.trap.className='tsfem-modal-trap',h.trap.tabIndex=0,h.bottomTrap=h.trap.cloneNode(!1),h.dialog.appendChild(h.trap),h.x=document.createElement('div'),h.x.className='tsfem-modal-dismiss',h.x.addEventListener('click',function(){window.dispatchEvent(new Event('tsfem_modalCancel'))}),h.dialog.appendChild(h.x),b&&(h.titleWrap=document.createElement('div'),h.titleWrap.className='tsfem-modal-title',h.titleWrapTitle=document.createElement('h4'),h.titleWrapTitle.innerHTML=b,h.titleWrap.appendChild(h.titleWrapTitle),h.dialog.appendChild(h.titleWrap)),h.inner=document.createElement('div'),h.inner.className='tsfem-modal-inner',c){if(h.textWrap=document.createElement('div'),h.textWrap.className='tsfem-modal-text',Array.isArray(c))for(let o in c)h.textWrapContent=document.createElement('p'),h.textWrapContent.innerHTML=c[o],h.textWrap.appendChild(h.textWrapContent);else h.textWrapContent=document.createElement('p'),h.textWrapContent.innerHTML=c,h.textWrap.appendChild(h.textWrapContent);h.inner.appendChild(h.textWrap)}let j=!1;if(d){j=!0,h.selectWrap=document.createElement('div'),h.selectWrap.className='tsfem-modal-select';let o={};o.wrap=document.createElement('div'),o.wrap.className='tsfem-modal-select-option',o.radio=document.createElement('input'),o.radio.setAttribute('type','radio'),o.radio.setAttribute('name','tsfem-modal-select-option-group'),o.radio.tabIndex=0,o.label=document.createElement('label'),function(){for(let p in d){let q=o.wrap.cloneNode(!0),r=o.radio.cloneNode(!1),s=o.label.cloneNode(!1);r.setAttribute('value',p),s.innerHTML=d[p],0==p&&(r.checked=!0);let t='tsfem-dialog-option-'+p;r.setAttribute('id',t),s.setAttribute('for',t),q.appendChild(r),q.appendChild(s),h.selectWrap.appendChild(q)}}(),h.inner.appendChild(h.selectWrap)}h.dialog.appendChild(h.inner),(f||g)&&(h.buttonWrap=document.createElement('div'),h.buttonWrap.className='tsfem-modal-buttons',f&&(h.confirmButton=document.createElement('button'),h.confirmButton.className='tsfem-modal-confirm tsfem-button-small',h.confirmButton.className+=j?' tsfem-button-primary tsfem-button-green':' tsfem-button',h.confirmButton.innerHTML=f,h.confirmButton.addEventListener('click',function(){let o;j&&(o={detail:{checked:document.querySelector('.tsfem-modal-select input:checked').value}}),window.dispatchEvent(new CustomEvent('tsfem_modalConfirm',o))}),h.buttonWrap.appendChild(h.confirmButton)),g&&(h.cancelButton=document.createElement('button'),h.cancelButton.className='tsfem-modal-cancel tsfem-button tsfem-button-small',h.cancelButton.innerHTML=g,h.cancelButton.addEventListener('click',()=>{window.dispatchEvent(new Event('tsfem_modalCancel'))}),h.buttonWrap.appendChild(h.cancelButton)),h.dialog.appendChild(h.buttonWrap)),h.dialog.appendChild(h.bottomTrap),h.dialogWrap.appendChild(h.dialog),h.container.appendChild(h.dialogWrap),document.body.appendChild(h.mask),document.body.appendChild(h.container);const k=()=>{h.trap.focus()};h.trap.addEventListener('focus',k),h.bottomTrap.addEventListener('focus',k),h.trap.focus(),tsfem.fadeIn(h.mask),tsfem.fadeIn(h.container);const l=o=>{o.preventDefault()};h.maskNoScroll.addEventListener('wheel',l),h.maskNoScroll.addEventListener('touchmove',l);const m=function(){h.dialogWrap.style.marginLeft=document.getElementById('adminmenuwrap').offsetWidth+'px',h.dialogWrap.style.marginTop=document.getElementById('wpadminbar').offsetHeight+'px'};window.addEventListener('resize',m);const n=()=>{h.maskNoScroll.removeEventListener('wheel',l),h.maskNoScroll.removeEventListener('touchmove',l),window.removeEventListener('tsfem_modalCancel',n),window.removeEventListener('tsfem_modalConfirm',n),window.removeEventListener('resize',m),tsfem.fadeOut(h.mask,250,()=>h.mask.remove()),tsfem.fadeOut(h.container,250,()=>h.container.remove())};window.addEventListener('tsfem_modalCancel',n),window.addEventListener('tsfem_modalConfirm',n)},fadeIn:function(a,b,c,d){if(!(void 0===a||!a instanceof HTMLElement)&&a.style&&'opacity'in a.style){b=b||250,d=void 0===d||d;let j,k,f=0,g=0,h=3;d?k=()=>{g=(f+=h)/100,a.style.display=null,a.style.opacity=g,1<=g&&(clearInterval(j),a.style.opacity=1,'function'==typeof c&&c())}:(f=100,k=()=>{g=(f-=h)/100,a.style.opacity=g,0>=g&&(clearInterval(j),a.style.opacity=0,setTimeout(()=>{a.style.display='none'},0),'function'==typeof c&&c())}),j=setInterval(k,b/100)}},fadeOut:function(a,b,c){tsfem.fadeIn(a,b,c,!1)},ready:function(a){a('#wpbody-content').find('.updated, .error, .notice-error, .notice-warning').appendTo('.tsfem-notice-wrap'),a('a#tsfem-enable-feeds').on('click',tsfem.updateFeed),a('.tsfem-button-extension-activate, .tsfem-button-extension-deactivate').on('click',tsfem.updateExtension),a('.tsfem-button-disabled').on('click',tsfem.preventDefault),a(document.body).ready(tsfem._initToolTips),a(document.body).ready(tsfem.setLastExtensionEntry),a(window).on('resize orientationchange',tsfem.setLastExtensionEntry),a('.tsfem-switch-button-container-wrap').on('click','label',tsfem.engageSwitcher),a(document.body).ready(tsfem.setDismissNoticeListener)}},jQuery(tsfem.ready);
