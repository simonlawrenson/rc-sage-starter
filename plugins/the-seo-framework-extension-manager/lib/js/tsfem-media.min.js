'use strict';window.tsfemMedia={data:'undefined'!=typeof tsfemMediaData&&tsfemMediaData,cropper:{},escapeKey:function(a){return a?a.replace(/(?!\\)(?=[\[\]\/])/g,'\\'):a},openImageEditor:function(a){let b=jQuery(a.target);if(b.prop('disabled')||'undefined'==typeof wp.media)return a.preventDefault(),void a.stopPropagation();let g,c=b.data('input-url'),d=tsfemMedia.escapeKey(c),e=b.data('input-id'),f=tsfemMedia.escapeKey(c);a.preventDefault(),a.stopPropagation(),tsfemMedia.extendCropper(),g=wp.media({button:{text:tsfemMedia.data.imgFrameButton,close:!1},states:[new wp.media.controller.Library({title:tsfemMedia.data.imgFrameTitle,library:wp.media.query({type:'image'}),multiple:!1,date:!1,priority:20,suggestedWidth:1920,suggestedHeight:1080}),new tsfemMedia.cropper({imgSelectOptions:tsfemMedia.calculateImageSelectOptions})]});g.on('select',function(){g.setState('cropper')}),g.on('cropped',function(l){let m=l.url,n=l.id,o=document.getElementById(c),p=document.getElementById(e);o.value=m,p.value=n,jQuery(o).trigger('change'),jQuery(p).trigger('change')}),g.on('skippedcrop',function(l){let m=l.get('url'),n=l.get('id'),o=document.getElementById(c),p=document.getElementById(e);o.value=m,p.value=n,jQuery(o).trigger('change'),jQuery(p).trigger('change')}),g.on('skippedcrop cropped',function(){jQuery('#'+d+'-select').text(tsfemMedia.data.imgChange),jQuery(document.getElementById(c)).prop('readonly',!0).css('opacity',0).animate({opacity:1},{queue:!0,duration:1000});let m={};m.url=c,m.id=e,tsfemMedia.appendRemoveButton(b,m,!0),b.trigger('blur'),tsfem.registerNavWarn(),g.close()}),g.open()},appendRemoveButton:function(a,b,c){if(a&&b.url){let d=tsfemMedia.escapeKey(b.url);jQuery('#'+d+'-remove').length||(a.after('<button type=button id="'+b.url+'-remove" class="tsfem-remove-image-button tsfem-button-primary tsfem-button-small" data-input-url="'+b.url+'" data-input-id="'+b.id+'" title="'+tsfemMedia.data.imgRemoveTitle+'">'+tsfemMedia.data.imgRemove+'</button>'),c&&jQuery('#'+d+'-remove').css('opacity',0).animate({opacity:1},{queue:!0,duration:1000}))}tsfemMedia.resetImageEditorRemovalActions()},removeEditorImage:function(a){let b=jQuery(a.target),c=b.data('input-url'),d=b.data('input-id'),e='tsfem-button-disabled',f=document.getElementById(c+'-select'),g=document.getElementById(c+'-remove');jQuery(f).prop('disabled')||(jQuery(f).addClass(e).prop('disabled',!0).text(tsfemMedia.data.imgSelect),jQuery(g).addClass(e).prop('disabled',!0).fadeOut(500,function(){jQuery(this).remove(),jQuery(f).removeClass(e).removeProp('disabled')}),jQuery(document.getElementById(c)).val('').removeProp('readonly').css('opacity',0).animate({opacity:1},{queue:!0,duration:500}),document.getElementById(d).value='',tsfem.registerNavWarn())},extendCropper:function(){if('undefined'==typeof tsfemMedia.cropper.control){var a;let b=wp.media.controller;return a=b.Cropper.extend({doCrop:function(c){var d=c.get('cropDetails'),e=tsfemMedia.cropper.control;if(e.params.flex_width&&e.params.flex_height)if(d.width===d.height)d.width>e.params.flex_width&&(d.dst_width=d.dst_height=e.params.flex_width);else if(d.width>e.params.flex_width||d.height>e.params.flex_height)if(d.width>d.height){var f=d.width/e.params.flex_width;d.dst_width=e.params.flex_width,d.dst_height=Math.round(d.height/f)}else{var f=d.height/e.params.flex_height;d.dst_height=e.params.flex_height,d.dst_width=Math.round(d.width/f)}return'undefined'==typeof d.dst_width&&(d.dst_width=0,d.dst_height=0),wp.ajax.post('tsfem_crop_image',{nonce:tsfemMedia.data.nonce,id:c.get('id'),context:'tsfem-image',cropDetails:d})}}),a.prototype.control={},a.control={params:{flex_width:4096,flex_height:4096,width:1920,height:1080}},void(tsfemMedia.cropper=a)}},calculateImageSelectOptions:function(a,b){let c=tsfemMedia.cropper.control;var d=!!parseInt(c.params.flex_width,10),e=!!parseInt(c.params.flex_height,10),f=parseInt(c.params.width,10),g=parseInt(c.params.height,10);let m,n,o,h=a.get('width'),i=a.get('height'),j=f/g,k=f,l=g;return b.set('control',c.params),b.set('canSkipCrop',!tsfemMedia.mustBeCropped(c.params.flex_width,c.params.flex_height,h,i)),h/i>j?(g=i,f=g*j):(f=h,g=f/j),m=(h-f)/2,n=(i-g)/2,o={handles:!0,keys:!0,instance:!0,persistent:!0,imageWidth:h,imageHeight:i,minWidth:k>f?f:k,minHeight:l>g?g:l,x1:m,y1:n,x2:f+m,y2:g+n},!1==e&&!1==d&&(o.aspectRatio=f+':'+g),!0==e&&(o.minHeight=200,o.maxWidth=h),!0==d&&(o.minWidth=200,o.maxHeight=i),o},mustBeCropped:function(a,b,c,d){return c<=a&&d<=b?!1:!0},checkImageEditorInput:function(){let a=jQuery('.tsfem-set-image-button');if(a.length){let b,c,d,e={};jQuery.each(a,function(f,g){if(d=jQuery(g),b=document.getElementById(d.data('input-url')),c=document.getElementById(d.data('input-id')),c.length&&0<c.value&&(e.url=d.data('input-url'),e.id=d.data('input-id'),jQuery(b).prop('readonly',!0),tsfemMedia.appendRemoveButton(d,e,!1)),b.value){let h=tsfemMedia.escapeKey(d.data('input-id'));jQuery('#'+h+'-select').text(tsfemMedia.data.imgChange)}})}},resetImageEditorRemovalActions:function(){jQuery('.tsfem-remove-image-button').off('click',tsfemMedia.removeEditorImage),jQuery('.tsfem-remove-image-button').on('click',tsfemMedia.removeEditorImage)},setupImageEditorActions:function(){const a=function(){jQuery('.tsfem-set-image-button').off('click',tsfemMedia.openImageEditor),jQuery('.tsfem-remove-image-button').off('click',tsfemMedia.removeEditorImage),jQuery('.tsfem-set-image-button').on('click',tsfemMedia.openImageEditor),jQuery('.tsfem-remove-image-button').on('click',tsfemMedia.removeEditorImage)};a(),jQuery(window).on('tsfemForm.iterationComplete tsfemForm.deiterationComplete',a)},ready:function(a){a(document.body).ready(tsfemMedia.setupImageEditorActions),a(document.body).ready(tsfemMedia.checkImageEditorInput)}},jQuery(tsfemMedia.ready);
